<?xml version="1.0"?>
<odoo>

    <report
        id="partner_open_invoices"
        model="res.partner"
        string="Open invoices"
        report_type="qweb-pdf"
        name="partner_report_open_invoices.report_partner_open_invoices"
        file="partner_report_open_invoices.report_partner_open_invoices"
    />

    <template id="report_partner_open_invoices">
        <t t-call="report.html_container">
            <t t-foreach="docs" t-as="partner">
                <t t-call="partner_report_open_invoices.report_partner_open_invoices_document" t-lang="partner.lang"/>
            </t>
        </t>
    </template>

    <template id="report_partner_open_invoices_document">
        <t t-call="report.external_layout">
            <div class="page">
                <div class="oe_structure"/>
                <h1>Open invoices</h1>

                <div class="row">
                    <div class="col-xs-6">
                        <div class="col-xs-6">
                            <span>Customer:</span>
                        </div>
                        <div class="col-xs-6">
                            <span t-field="partner.name" />
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-xs-6">
                        <div class="col-xs-6">
                            <span>Date:</span>
                        </div>
                        <div class="col-xs-6">
                            <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%d.%m.%Y')"/>
                        </div>
                    </div>
                </div>

                <t t-set="invoices" t-value="partner.invoice_ids.filtered(lambda i: i.state == 'open')" />

                <table t-if="invoices" class="table table-condensed mt32">
                    <thead>
                        <tr>
                            <th>Invoice number</th>
                            <th>Source document</th>
                            <th>Due date</th>
                            <th>Amount</th>
                            <th>Amount due</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr t-foreach="invoices" t-as="invoice">
                            <td><span t-field="invoice.number" /></td>
                            <td><span t-field="invoice.origin" /></td>
                            <td><span t-field="invoice.date_due" /></td>
                            <td><span t-field="invoice.amount_total" /></td>
                            <td><span t-field="invoice.residual" /></td>
                        </tr>
                    </tbody>
                </table>
                <div t-else="">
                    <h2>This customer has no open invoices</h2>
                </div>

                <!-- Page break -->
                <p style="page-break-before:always;"> </p>
            </div>
        </t>
    </template>

</odoo>
