<?xml version="1.0"?>
<odoo>

    <!-- Form view for child_ids -->
    <record id="view_partner_form_contact" model="ir.ui.view">
        <field name="name">res.partner.form.child.ids</field>
        <field name="model">res.partner</field>
        <field name="type">form</field>
        <field name="priority" eval="20" />
        <field name="arch" type="xml">
            <form string="Address">
                <sheet>
                    <field name="type" required="1" widget="radio" options="{'horizontal': true}"/>
                    <hr/>
                    <group>
                        <group attrs="{'invisible': [('type','=', 'contact')]}">
                            <label for="street" string="Address"/>
                            <div>
                                <div class="o_address_format" name="div_address">
                                    <field name="street" placeholder="Street..." class="o_address_street"/>
                                    <field name="street2" placeholder="Street 2..." class="o_address_street"/>
                                    <field name="city" placeholder="City" class="o_address_city"/>
                                    <field name="state_id" class="o_address_state" placeholder="State" options='{"no_open": True}' context="{'country_id': country_id, 'zip': zip}"/>
                                    <field name="zip" placeholder="ZIP" class="o_address_zip"/>
                                    <field name="country_id" placeholder="Country" class="o_address_country" options='{"no_open": True, "no_create": True}'/>
                                </div>
                            </div>
                        </group>
                        <group>
                            <field name="name" string="Contact Name" attrs="{'required' : [('type', '=', 'contact')]}"/>
                            <field name="title" placeholder="e.g. Mr."
                                attrs="{'invisible': [('type','&lt;&gt;', 'contact')]}"/>
                            <field name="function" placeholder="e.g. Sales Director"
                                attrs="{'invisible': [('type','&lt;&gt;', 'contact')]}"/>
                            <field name="email"/>
                            <field name="phone" widget="phone"/>
                            <field name="mobile" widget="phone"/>
                            <field name="comment" placeholder="internal note..."/>
                        </group>
                    </group>
                    <field name="supplier" invisible="True"/>
                    <field name="customer" invisible="True"/>
                    <field name="lang" invisible="True"/>
                    <field name="image" invisible="True"/>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Tree view for contact ids -->
    <record id="view_partner_tree_contact" model="ir.ui.view">
        <field name="name">res.partner.tree.child.ids</field>
        <field name="model">res.partner</field>
        <field eval="20" name="priority"/>

        <field name="arch" type="xml">

            <tree delete="false">
                <field name='name' />
                <field name='phone' />
                <field name='email' />
                <field name='function' />
            </tree>

        </field>
    </record>

    <!-- Tree view for address ids -->
    <record id="view_partner_tree_address" model="ir.ui.view">
        <field name="name">res.partner.tree.child.ids</field>
        <field name="model">res.partner</field>
        <field eval="20" name="priority"/>

        <field name="arch" type="xml">

            <tree delete="false">
                <field name='name' />
                <field name='street' />
                <field name='zip' />
                <field name='city' />
                <field name='country_id' />
            </tree>

        </field>
    </record>

    <record id="view_partner_form" model="ir.ui.view">
        <field name="name">res.partner.form.address</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">

            <!-- We have to use page[1] to get the "Contacts & Addresses"
            even if it's not foolproof, as we can't reference by string -->
            <xpath expr="//page[1]" position="attributes">
                <attribute name="name">contacts</attribute>
                <attribute name="string">Contacts</attribute>
            </xpath>

            <field name="child_ids" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>

            <field name="child_ids" position="before">
                <field name="contact_ids" mode="tree"
                   context="{
                   'form_view_ref': 'res_partner_addresses_page.view_partner_form_contact',
                   'tree_view_ref': 'res_partner_addresses_page.view_partner_tree_contact',
                   'default_parent_id': active_id,
                   'default_street': street,
                   'default_street2': street2,
                   'default_city': city,
                   'default_state_id': state_id,
                   'default_zip': zip,
                   'default_country_id': country_id,
                   'default_supplier': supplier,
                   'default_customer': customer,
                   'default_lang': lang,
                   'default_type': 'contact'
                   }"
                />
            </field>

            <page name="contacts" position="after">
                <page name="addresses" string="Addresses">
                    <field name="address_ids" mode="tree"
                           context="{
                           'tree_view_ref': 'res_partner_addresses_page.view_partner_tree_address',
                           'default_parent_id': active_id,
                           'default_street': street,
                           'default_street2': street2,
                           'default_city': city,
                           'default_state_id': state_id,
                           'default_zip': zip,
                           'default_country_id': country_id,
                           'default_supplier': supplier,
                           'default_customer': customer,
                           'default_lang': lang,
                           'default_type': 'invoice'
                           }"
                    />
                </page>
            </page>

        </field>
    </record>
</odoo>